<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Taxi kalkulaƒçka</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#f2f2f2;
  margin:0;
  padding:12px;
}
h1{text-align:center;}
.card{
  background:white;
  padding:14px;
  border-radius:12px;
  margin-bottom:12px;
}
label{font-weight:600;margin-top:10px;display:block;}
input,button{
  width:100%;
  padding:12px;
  font-size:16px;
  margin-top:6px;
}
button{
  background:#007aff;
  color:white;
  border:none;
  border-radius:10px;
}
iframe{
  width:100%;
  height:260px;
  border:none;
  border-radius:12px;
}
.result{font-size:18px;font-weight:bold;}
.green{color:green;}
.red{color:red;}
</style>
</head>

<body>

<h1>üöï Taxi kalkulaƒçka</h1>

<div class="card">
  <label>Poloha vozidla</label>
  <input id="vehicleStatus" readonly placeholder="GPS nenaƒç√≠tan√©">
  <button onclick="loadGPS()">üìç Naƒç√≠ta≈• GPS</button>

  <label>Miesto n√°stupu klienta</label>
  <input id="startAddr" placeholder="Ulica, mesto">

  <label>Cieƒæ klienta</label>
  <input id="endAddr" placeholder="Ulica, mesto">
</div>

<iframe id="map"
  src="https://www.openstreetmap.org/export/embed.html?layer=mapnik">
</iframe>

<div id="result" class="card result">
  ƒåakanie na √∫daje‚Ä¶
</div>

<script>
/* === SADZBY (SKRYT√â PRE VODIƒåA) === */
const RATE_PICKUP = 0.31; // pristavenie
const RATE_RIDE   = 0.85; // jazda
const COST_RATE   = 0.31; // n√°klady / km

let vehicle=null, start=null, end=null;

/* === GPS === */
function loadGPS(){
  navigator.geolocation.getCurrentPosition(pos=>{
    vehicle={lat:pos.coords.latitude,lon:pos.coords.longitude};
    vehicleStatus.value="Poloha naƒç√≠tan√°";
    updateMap(vehicle.lat,vehicle.lon);
  },()=>alert("GPS nedostupn√©"));
}

/* === ADRESA ‚Üí S√öRADNICE === */
async function geocode(address){
  const r=await fetch(
    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`
  );
  const j=await r.json();
  if(!j.length) throw "Nen√°jden√©";
  return {lat:+j[0].lat,lon:+j[0].lon};
}

/* === MAPA === */
function updateMap(lat,lon){
  map.src=
    `https://www.openstreetmap.org/export/embed.html?bbox=${lon-0.02},${lat-0.02},${lon+0.02},${lat+0.02}&layer=mapnik&marker=${lat},${lon}`;
}

/* === TRASA (OSRM) === */
async function routeKm(a,b,c,d){
  const r=await fetch(
    `https://router.project-osrm.org/route/v1/driving/${b},${a};${d},${c}?overview=false`
  );
  const j=await r.json();
  return j.routes[0].distance/1000;
}

/* === V√ùPOƒåET === */
async function calculate(){
  if(!vehicle||!start||!end) return;

  const kmPickup=await routeKm(
    vehicle.lat,vehicle.lon,
    start.lat,start.lon
  );

  const kmRide=await routeKm(
    start.lat,start.lon,
    end.lat,end.lon
  );

  const price =
    kmPickup*RATE_PICKUP +
    kmRide*RATE_RIDE;

  const costs =
    (kmPickup+kmRide)*COST_RATE;

  const profit=price-costs;

  result.innerHTML=`
    Cena jazdy: ${price.toFixed(2)} ‚Ç¨<br>
    N√°klady: ${costs.toFixed(2)} ‚Ç¨<br>
    V√Ωsledok: ${profit.toFixed(2)} ‚Ç¨
  `;

  result.className="card result "+(profit>=0?"green":"red");
}

/* === EVENTY === */
startAddr.onchange=async()=>{
  try{
    start=await geocode(startAddr.value);
    updateMap(start.lat,start.lon);
    calculate();
  }catch{alert("N√°stup nen√°jden√Ω");}
};

endAddr.onchange=async()=>{
  try{
    end=await geocode(endAddr.value);
    updateMap(end.lat,end.lon);
    calculate();
  }catch{alert("Cieƒæ nen√°jden√Ω");}
};
</script>

</body>
</html>
