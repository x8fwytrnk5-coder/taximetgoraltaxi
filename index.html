<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Taxi kalkulaƒçka</title>

<style>
body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#f2f2f2;margin:0;padding:12px;}
h1{text-align:center;}
.card{background:white;padding:14px;border-radius:12px;margin-bottom:12px;}
label{font-weight:600;margin-top:10px;display:block;}
input,button{width:100%;padding:12px;font-size:16px;margin-top:6px;}
button{background:#007aff;color:white;border:none;border-radius:10px;}
iframe{width:100%;height:260px;border:none;border-radius:12px;}
.result{font-size:18px;font-weight:bold;}
.green{color:green;}
.red{color:red;}
</style>
</head>
<body>

<h1>üöï Taxi kalkulaƒçka</h1>

<div class="card">
  <label>Poloha vozidla</label>
  <input id="vehicleStatus" readonly placeholder="GPS nenaƒç√≠tan√©">
  <button onclick="loadGPS()">üìç Naƒç√≠ta≈• GPS</button>

  <label>Miesto n√°stupu klienta</label>
  <input id="startAddr" placeholder="Ulica, mesto">

  <label>Cieƒæ klienta</label>
  <input id="endAddr" placeholder="Ulica, mesto">

  <label>Cena z cenn√≠ka (‚Ç¨)</label>
  <input id="priceCennik" placeholder="Zadajte cenu z cenn√≠ka">
</div>

<iframe id="map" src="https://www.openstreetmap.org/export/embed.html?layer=mapnik"></iframe>

<div class="card result" id="result">
  ƒåakanie na √∫daje‚Ä¶
</div>

<script>
/* === SADZBY INTERN√â (len n√°klady) === */
const COST_RATE = 0.31; // n√°klady / km

let vehicle=null, start=null, end=null;

/* === GPS === */
function loadGPS(){
  navigator.geolocation.getCurrentPosition(p=>{
    vehicle={lat:p.coords.latitude,lon:p.coords.longitude};
    vehicleStatus.value="Poloha naƒç√≠tan√°";
    updateMap(vehicle.lat,vehicle.lon);
  },()=>alert("GPS nedostupn√©"));
}

/* === GEOCODING (Nominatim) === */
async function geocode(address){
  const r=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`);
  const j=await r.json();
  if(!j.length) throw "Nen√°jden√©";
  return {lat:+j[0].lat,lon:+j[0].lon};
}

/* === MAPA === */
function updateMap(lat,lon){
  map.src=`https://www.openstreetmap.org/export/embed.html?bbox=${lon-0.02},${lat-0.02},${lon+0.02},${lat+0.02}&layer=mapnik&marker=${lat},${lon}`;
}

/* === TRASA (OSRM) === */
async function routeKm(a,b,c,d){
  const r=await fetch(`https://router.project-osrm.org/route/v1/driving/${b},${a};${d},${c}?overview=false`);
  const j=await r.json();
  return j.routes[0].distance/1000;
}

/* === V√ùPOƒåET === */
async function calculate(){
  if(!vehicle||!start||!end) return;
  const cennikValue = parseFloat(document.getElementById("priceCennik").value);
  if(isNaN(cennikValue)) return;

  const kmPickup = await routeKm(vehicle.lat,vehicle.lon,start.lat,start.lon);
  const kmRide   = await routeKm(start.lat,start.lon,end.lat,end.lon);

  const costs = (kmPickup + kmRide) * COST_RATE;
  const profit = cennikValue - costs;

  result.innerHTML=`
    N√°klady: ${costs.toFixed(2)} ‚Ç¨<br>
    Cena z cenn√≠ka: ${cennikValue.toFixed(2)} ‚Ç¨<br>
    Zisk / Strata: ${profit.toFixed(2)} ‚Ç¨
  `;

  result.className="card result "+(profit>=0?"green":"red");
}

/* === EVENTY === */
startAddr.onchange=calculate;
endAddr.onchange=calculate;
document.getElementById("priceCennik").onchange=calculate;
</script>

</body>
</html>
