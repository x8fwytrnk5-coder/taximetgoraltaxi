<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Taxi kalkulaƒçka (iPhone)</title>

<style>
body {
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#f2f2f2;
  padding:12px;
  margin:0;
}
h1 { text-align:center; }

.card {
  background:white;
  padding:14px;
  border-radius:12px;
  margin-bottom:12px;
}
label { font-weight:600; display:block; margin-top:10px; }
input,button {
  width:100%;
  padding:12px;
  font-size:16px;
  margin-top:6px;
}
button {
  background:#007aff;
  color:white;
  border:none;
  border-radius:10px;
}
iframe {
  width:100%;
  height:280px;
  border-radius:12px;
  border:none;
}
.result {
  font-size:18px;
  font-weight:bold;
}
</style>
</head>

<body>

<h1>üöï Taxi kalkulaƒçka</h1>

<div class="card">
  <label>Poloha vozidla</label>
  <input id="vehicle" readonly placeholder="GPS nenaƒç√≠tan√©">
  <button onclick="loadGPS()">üìç Naƒç√≠ta≈• polohu</button>

  <label>N√°stup klienta (s√∫radnice)</label>
  <input id="start" placeholder="napr. 48.15,17.11">

  <label>Cieƒæ klienta (s√∫radnice)</label>
  <input id="end" placeholder="napr. 48.20,17.15">
</div>

<iframe id="map"
src="https://www.openstreetmap.org/export/embed.html?bbox=17.05,48.12,17.15,48.20&layer=mapnik">
</iframe>

<div id="result" class="card result">
  ƒåakanie na √∫daje‚Ä¶
</div>

<script>
const RATE_PICKUP = 0.31;
const RATE_RIDE = 0.85;

function loadGPS(){
  navigator.geolocation.getCurrentPosition(p=>{
    vehicle.value=p.coords.latitude.toFixed(6)+","+p.coords.longitude.toFixed(6);
    updateMap(p.coords.latitude,p.coords.longitude);
  });
}

function updateMap(lat,lon){
  map.src=`https://www.openstreetmap.org/export/embed.html?bbox=${lon-0.05},${lat-0.05},${lon+0.05},${lat+0.05}&layer=mapnik`;
}

async function km(a,b,c,d){
  const r=await fetch(`https://router.project-osrm.org/route/v1/driving/${b},${a};${d},${c}?overview=false`);
  const j=await r.json();
  return j.routes[0].distance/1000;
}

async function calculate(){
  const [vlat,vlon]=vehicle.value.split(",").map(Number);
  const [slat,slon]=start.value.split(",").map(Number);
  const [elat,elon]=end.value.split(",").map(Number);

  const k1=await km(vlat,vlon,slat,slon);
  const k2=await km(slat,slon,elat,elon);

  const sum=k1*RATE_PICKUP+k2*RATE_RIDE;
  result.innerText=`Cena / N√°klady: ${sum.toFixed(2)} ‚Ç¨`;
}

start.onchange=end.onchange=calculate;
</script>

</body>
</html>
